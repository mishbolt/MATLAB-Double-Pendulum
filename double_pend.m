function difeq = double_pend(t,X)
mu = 2;
lam = 2;


dxdt1 = (X(3)*1/lam-X(4)*cos(X(1)-X(2)))/(mu+(sin(X(1)-X(2)))^2);
dxdt2 = (lam*(mu+1)*X(4)-X(3)*cos(X(1)-X(2)))/(mu+(sin(X(1)-X(2)))^2);
dxdt3 = -(X(3)*X(4)*sin(X(1)-X(2)))/((mu+(sin(X(1)-X(2)))^2))+...
    (sin(2*(X(1)-X(2)))*(1/2*1/lam*(X(3))^2+1/2*lam*(mu+1)*(X(4))^2-X(3)*X(4)*cos(X(1)-X(2))))/...
    (mu+(sin(X(1)-X(2)))^2)^2-(mu+1)*sin(X(1));
dxdt4 = (X(3)*X(4)*sin(X(1)-X(2)))/((mu+(sin(X(1)-X(2)))^2))...
    -(sin(2*(X(1)-X(2)))*(1/2*1/lam*(X(3))^2+1/2*lam*(mu+1)*...
    (X(4))^2-X(3)*X(4)*cos(X(1)-X(2))))/(mu+(sin(X(1)-X(2)))^2)^2-1/lam*sin(X(2));


A = zeros(4,4);

A(1,1) = lam.^(-1).*(1+mu+(-1).*cos(X(1)+(-1).*X(2)).^2).^(-2).*(lam.*(1+mu).* ...
  X(4)+(-2).*X(3).*cos(X(1)+(-1).*X(2))+lam.*X(4).*cos(X(1)+(-1).*X(2)).^2).*sin( ...
  X(1)+(-1).*X(2));
A(2,1) = (1+mu+(-1).*cos(X(1)+(-1).*X(2)).^2).^(-2).*((1+mu).*X(3)+(-2).*lam.*(1+ ...
  mu).*X(4).*cos(X(1)+(-1).*X(2))+X(3).*cos(X(1)+(-1).*X(2)).^2).*sin(X(1)+(-1).* ...
  X(2));
A(3,1) = lam.^(-1).*(1+mu+(-1).*cos(X(1)+(-1).*X(2)).^2).^(-3).*((-4).*cos(X(1)+( ...
  -1).*X(2)).*sin(X(1)+(-1).*X(2)).*((-1/4).*lam.*(1+mu).*((-1)+(-2).*mu+ ...
  cos(2.*(X(1)+(-1).*X(2)))).^2.*sin(X(1))+((-1).*lam.*(1+mu).*X(4)+X(3).*cos( ...
  X(1)+(-1).*X(2))).*(X(3)+(-1).*lam.*X(4).*cos(X(1)+(-1).*X(2))).*sin(X(1)+(-1).* ...
  X(2)))+(1+mu+(-1).*cos(X(1)+(-1).*X(2)).^2).*(cos(X(1)+(-1).*X(2)).*((-1).* ...
  lam.*(1+mu).*X(4)+X(3).*cos(X(1)+(-1).*X(2))).*(X(3)+(-1).*lam.*X(4).*cos(X(1)+( ...
  -1).*X(2)))+(-1/4).*lam.*(1+mu).*cos(X(1)).*((-1)+(-2).*mu+cos(2.*(X(1)+ ...
  (-1).*X(2)))).^2+lam.*X(4).*((-1).*lam.*(1+mu).*X(4)+X(3).*cos(X(1)+(-1).* ...
  X(2))).*sin(X(1)+(-1).*X(2)).^2+X(3).*((-1).*X(3)+lam.*X(4).*cos(X(1)+(-1).*X(2))) ...
  .*sin(X(1)+(-1).*X(2)).^2+lam.*(1+mu).*((-1)+(-2).*mu+cos(2.*(X(1)+(-1) ...
  .*X(2)))).*sin(X(1)).*sin(2.*(X(1)+(-1).*X(2)))));

A(4,1) = lam.^(-1).*(1+2.*mu+(-1).*cos(2.*(X(1)+(-1).*X(2)))).^(-3).*(6.*X(3).^2+ ...
  6.*lam.^2.*X(4).^2+6.*lam.^2.*mu.*X(4).^2+lam.*((-11)+4.*mu+8.*mu.^2) ...
  .*X(3).*X(4).*cos(X(1)+(-1).*X(2))+(-4).*(1+2.*mu).*(X(3).^2+lam.^2.*(1+mu) ...
  .*X(4).^2).*cos(2.*(X(1)+(-1).*X(2)))+(21/2).*lam.*X(3).*X(4).*cos(3.*(X(1)+( ...
  -1).*X(2)))+12.*lam.*mu.*X(3).*X(4).*cos(3.*(X(1)+(-1).*X(2)))+(-2).*X(3).^2.* ...
  cos(4.*(X(1)+(-1).*X(2)))+(-2).*lam.^2.*X(4).^2.*cos(4.*(X(1)+(-1).*X(2)))+( ...
  -2).*lam.^2.*mu.*X(4).^2.*cos(4.*(X(1)+(-1).*X(2)))+(1/2).*lam.*X(3).*X(4).* ...
 cos(5.*(X(1)+(-1).*X(2))));

A(1,2) = (-1).*lam.^(-1).*(1+mu+(-1).*cos(X(1)+(-1).*X(2)).^2).^(-2).*(lam.*(1+ ...
  mu).*X(4)+(-2).*X(3).*cos(X(1)+(-1).*X(2))+lam.*X(4).*cos(X(1)+(-1).*X(2)).^2).* ...
  sin(X(1)+(-1).*X(2));

A(2,2) = (-1).*(1+mu+(-1).*cos(X(1)+(-1).*X(2)).^2).^(-2).*((1+mu).*X(3)+(-2).* ...
  lam.*(1+mu).*X(4).*cos(X(1)+(-1).*X(2))+X(3).*cos(X(1)+(-1).*X(2)).^2).*sin( ...
  X(1)+(-1).*X(2));

A(3,2) = lam.^(-1).*(1+mu+(-1).*cos(X(1)+(-1).*X(2)).^2).^(-3).*(4.*cos(X(1)+(-1) ...
  .*X(2)).*sin(X(1)+(-1).*X(2)).*((-1/4).*lam.*(1+mu).*((-1)+(-2).*mu+cos( ...
  2.*(X(1)+(-1).*X(2)))).^2.*sin(X(1))+((-1).*lam.*(1+mu).*X(4)+X(3).*cos(X(1)+( ...
  -1).*X(2))).*(X(3)+(-1).*lam.*X(4).*cos(X(1)+(-1).*X(2))).*sin(X(1)+(-1).*X(2))) ...
  +(1+mu+(-1).*cos(X(1)+(-1).*X(2)).^2).*((-1).*(X(3).^2+lam.^2.*(1+mu).* ...
  X(4).^2).*cos(X(1)+(-1).*X(2)).^2+lam.*X(3).*X(4).*cos(X(1)+(-1).*X(2)).^3+lam.* ...
  X(3).*X(4).*cos(X(1)+(-1).*X(2)).*(mu+cos(2.*(X(1)+(-1).*X(2))))+(X(3).^2+ ...
  lam.^2.*(1+mu).*X(4).^2).*sin(X(1)+(-1).*X(2)).^2+lam.*(1+mu).*(1+2.*mu+ ...
  (-1).*cos(2.*(X(1)+(-1).*X(2)))).*sin(X(1)).*sin(2.*(X(1)+(-1).*X(2)))));

A(4,2) = lam.^(-1).*((-1)+(-2).*mu+cos(2.*(X(1)+(-1).*X(2)))).^(-3).*((-4).* ...
  sin(2.*(X(1)+(-1).*X(2))).*(2.*lam.*X(3).*X(4).*(3+2.*mu+cos(2.*(X(1)+(-1).* ...
  X(2)))).*sin(X(1)+(-1).*X(2))+(-2).*(X(3).^2+lam.^2.*(1+mu).*X(4).^2).*sin( ...
  2.*(X(1)+(-1).*X(2)))+(-1).*((-1)+(-2).*mu+cos(2.*(X(1)+(-1).*X(2)))).^2.* ...
  sin(X(2)))+((-1)+(-2).*mu+cos(2.*(X(1)+(-1).*X(2)))).*(4.*(X(3).^2+ ...
  lam.^2.*(1+mu).*X(4).^2).*cos(2.*(X(1)+(-1).*X(2)))+(-2).*lam.*X(3).*X(4).* ...
  cos(X(1)+(-1).*X(2)).*(3+2.*mu+cos(2.*(X(1)+(-1).*X(2))))+(-1).*((-1)+(-2) ...
  .*mu+cos(2.*(X(1)+(-1).*X(2)))).^2.*cos(X(2))+8.*lam.*X(3).*X(4).*cos(X(1)+( ...
  -1).*X(2)).*sin(X(1)+(-1).*X(2)).^2+(-4).*((-1)+(-2).*mu+cos(2.*(X(1)+(-1) ...
  .*X(2)))).*sin(2.*(X(1)+(-1).*X(2))).*sin(X(2))));

A(1,3) = (lam+lam.*mu+(-1).*lam.*cos(X(1)+(-1).*X(2)).^2).^(-1);

A(2,3) = cos(X(1)+(-1).*X(2)).*((-1)+(-1).*mu+cos(X(1)+(-1).*X(2)).^2).^(-1);

A(3,3) = (-1).*lam.^(-1).*(1+mu+(-1).*cos(X(1)+(-1).*X(2)).^2).^(-2).*(lam.*(1+ ...
  mu).*X(4)+(-2).*X(3).*cos(X(1)+(-1).*X(2))+lam.*X(4).*cos(X(1)+(-1).*X(2)).^2).* ...
  sin(X(1)+(-1).*X(2));

A(4,3) = 2.*lam.^(-1).*((-1)+(-2).*mu+cos(2.*(X(1)+(-1).*X(2)))).^(-2).*((-4).* ...
  X(3).*cos(X(1)+(-1).*X(2))+lam.*X(4).*(3+2.*mu+cos(2.*(X(1)+(-1).*X(2))))).* ...
  sin(X(1)+(-1).*X(2));

A(1,4) = cos(X(1)+(-1).*X(2)).*((-1)+(-1).*mu+cos(X(1)+(-1).*X(2)).^2).^(-1);
A(2,4) = lam.*(1+mu).*(1+mu+(-1).*cos(X(1)+(-1).*X(2)).^2).^(-1);

A(3,4) = (-1).*(1+mu+(-1).*cos(X(1)+(-1).*X(2)).^2).^(-2).*((1+mu).*X(3)+(-2).* ...
  lam.*(1+mu).*X(4).*cos(X(1)+(-1).*X(2))+X(3).*cos(X(1)+(-1).*X(2)).^2).*sin( ...
  X(1)+(-1).*X(2));

A(4,4) = 2.*((-1)+(-2).*mu+cos(2.*(X(1)+(-1).*X(2)))).^(-2).*((-4).*lam.*(1+mu) ...
  .*X(4).*cos(X(1)+(-1).*X(2))+X(3).*(3+2.*mu+cos(2.*(X(1)+(-1).*X(2))))).*sin( ...
  X(1)+(-1).*X(2));

%Diff.eq for the Monodromy matrix
jacobian = A*[X(5),X(6),X(7),X(8);
              X(9),X(10),X(11),X(12);
              X(13),X(14),X(15),X(16);
              X(17),X(18),X(19),X(20)];
              
 difeq = [dxdt1;dxdt2;dxdt3;dxdt4;jacobian(1,:)';jacobian(2,:)';jacobian(3,:)';jacobian(4,:)'];           


end